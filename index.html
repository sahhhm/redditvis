<html>
  <head>
    <title>RedditVis</title>
    <link type="text/css" rel="stylesheet" href="style/style.css"/>
    <link type="text/css" rel="stylesheet" href="style/jquery-ui-1.8.14.custom.css"/>
    <script type="text/javascript" src="js/protovis-r3.2.js"></script>
    <script type="text/javascript" src="js/jquery-1.6.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="js/redditvis.js"></script>
    <script type="text/javascript" src="js/data.js"></script>
    <script type="text/javascript" src="js/lib.js"></script>

    <script>
        var vis;
        var my_redditor = new Redditor;
        $(function() {
          $("#interactions").hide();
          
          // Comments/Submitted buttons
          $("#buttongroup").buttonset();
          $("#comment_button, #submitted_button").click(function() {	  
            my_redditor.filters.comments = $("#comment_button").is(":checked");
            my_redditor.filters.submitted = $("#submitted_button").is(":checked");
            my_redditor.update();
          });

          // date slider
          $("#date_slider").slider({
            range: true,
            values: [0,0],
              slide: function( event, ui ) {
                $("#date_amount").val(format_date(ui.values[0]) + " - " + format_date(ui.values[1]));
                my_redditor.filters.min_date = ui.values[0];
                my_redditor.filters.max_date = ui.values[1];
                my_redditor.update();
            }
          });

          // score slider
          $("#score_slider").slider({
            range: true,
            values: [0,0],
              slide: function( event, ui ) {
                $("#score_amount").val(ui.values[0] + " - " + ui.values[1]);
                my_redditor.filters.min_score = ui.values[0];
                my_redditor.filters.max_score = ui.values[1];
                my_redditor.update();
            }
          });
          
          // selectable subreddits
          $("#selectable_subreddits").bind("mousedown", function(e) {
            e.metaKey = true; // force "ctrl" for the user
          }).selectable({
            stop: function() {
                my_redditor.update();
            }
          }); 
        
          $("#subreddits_all").bind("click", function() { 
            $('.selectable').each(function() {
                if (!$(this).hasClass("ui-selected")) {
                  $(this).addClass("ui-selected");   
                }
                my_redditor.update();
            });
          });
          
          $("#subreddits_none").bind("click", function() { 
            $('.selectable').each(function() {
                if ($(this).hasClass("ui-selected")) {
                  $(this).removeClass("ui-selected");   
                }
                my_redditor.update();
            });
          });
          
          // filter the subreddits as the user types
          $("#subreddits_opts_text").bind("keyup", function() {
            var text = $(this).val().toLowerCase();
            $('.selectable').each(function() {
                $(this).text().toLowerCase().match(text) ? $(this).show("medium") : $(this).hide("medium");
            });            
          });
          
          // Submit button for choosing new username
          $("#username_submit").click(function() {  
              my_redditor.username = $("#username_input").val();
              get_data(my_redditor);	
              
              // show the filters
              $("#interactions").fadeIn(5000);
              $("#toremove").remove();
          });
        });
    </script>
  </head>
  
  <body>
    <!-- User Selector -->
    <div id="user">
      <input id="username_input" type="text" class="user"/> 
      <button id="username_submit" class="user">submit</button>
    </div>
  
    <!-- Visualization -->
    <div id="fig">
      <script>
        redditvis(my_redditor);	
      </script>
    </div>
    
    <!-- Interactions -->
    <div id="interactions">
      <!-- Comments/Submissions buttonset -->
      <div id="buttongroup">
        <input type="checkbox" id="comment_button" checked="yes"/><label for="comment_button">Comments</label>
        <input type="checkbox" id="submitted_button" checked="yes"/><label for="submitted_button">Submissions</label>
      </div>
      
      <div id="toremove">      
      <!-- Date Range -->    
      <div id="date_range">
        <p>
          <label for="date_amount">Date range:</label>
          <input type="text" id="date_amount" style="border:0; color:#f6931f; font-weight:bold;" />
        </p>
        <div id="date_slider"></div>
      </div>
      
      <!-- Score Range -->
      <div id="score_range">
        <p>
          <label for="score_amount">Score range:</label>
          <input type="text" id="score_amount" style="border:0; color:#f6931f; font-weight:bold;" />
        </p>
        <div id="score_slider"></div>
      </div>
      </div>
      <!-- Subreddit selectors -->
      <div id="subreddits_opts">
        <input type="text" id="subreddits_opts_text"/>
        <a id="subreddits_all" class="subreddits_opts" href="#">all</a> | <a id="subreddits_none" class ="subreddits_opts" href="#">none</a>
      </div>      
      <div id="subreddits">
        <ol id="selectable_subreddits">
        </ol>      
      </div>
    </div>
  </body>

</html>
